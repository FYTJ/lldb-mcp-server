{
  "schemaVersion": "1.0",
  "name": "lldb-mcp",
  "displayName": "LLDB MCP Server",
  "version": "0.1.0",
  "description": "基于 LLDB 的本地调试 MCP，支持断点、表达式、寄存器、监视点、读写内存、反汇编与会话管理，返回原生 lldb transcript。",
  "authors": [
    { "name": "LLDB MCP Maintainers" }
  ],
  "license": "UNLICENSED",
  "homepage": "https://example.com",
  "categories": ["Debugging", "Developer Tools"],
  "os": ["macos"],
  "arch": ["arm64", "x86_64"],
  "transport": "stdio",
  "entry": {
    "command": "python3",
    "args": ["-u", "-m", "lldb_mcp_server.mcp.server"],
    "env": { "PYTHONPATH": "src" },
    "cwdRelative": "."
  },
  "requirements": [
    { "type": "binary", "name": "lldb", "version": ">= 1200" },
    { "type": "binary", "name": "python3", "version": ">= 3.10" }
  ],
  "permissions": [
    { "name": "process_debug", "description": "附加与控制本机进程可能需要系统权限" }
  ],
  "tools": [
    {
      "name": "lldb.initialize",
      "description": "创建新调试会话",
      "arguments": { "type": "object", "properties": {}, "additionalProperties": false },
      "returns": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" } } }
    },
    {
      "name": "lldb.terminate",
      "description": "终止会话",
      "arguments": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" } } },
      "returns": { "type": "object", "properties": { "ok": { "type": "boolean" } } }
    },
    {
      "name": "lldb.listSessions",
      "description": "列出当前会话",
      "arguments": { "type": "object", "properties": {}, "additionalProperties": false },
      "returns": { "type": "object", "properties": { "sessions": { "type": "array", "items": { "type": "string" } } } }
    },
    {
      "name": "lldb.createTarget",
      "description": "创建 LLDB 目标",
      "arguments": {
        "type": "object",
        "required": ["sessionId", "file"],
        "properties": {
          "sessionId": { "type": "string" },
          "file": { "type": "string" },
          "arch": { "type": "string" },
          "triple": { "type": "string" },
          "platform": { "type": "string" }
        }
      },
      "returns": {
        "type": "object",
        "required": ["triple", "platform", "transcript"],
        "properties": {
          "triple": { "type": "string" },
          "platform": { "type": "string" },
          "transcript": { "type": "string" }
        }
      }
    },
    {
      "name": "lldb.launch",
      "description": "启动目标进程",
      "arguments": {
        "type": "object",
        "required": ["sessionId"],
        "properties": {
          "sessionId": { "type": "string" },
          "args": { "type": "array", "items": { "type": "string" } },
          "env": { "type": "object", "additionalProperties": { "type": "string" } },
          "cwd": { "type": "string" },
          "flags": { "type": "object", "additionalProperties": { "type": "string" } }
        }
      },
      "returns": {
        "type": "object",
        "required": ["pid", "state", "transcript"],
        "properties": {
          "pid": { "type": "integer" },
          "state": { "type": "integer" },
          "transcript": { "type": "string" }
        }
      }
    },
    {
      "name": "lldb.attach",
      "description": "附加到运行中的进程",
      "arguments": {
        "type": "object",
        "required": ["sessionId", "pid"],
        "properties": {
          "sessionId": { "type": "string" },
          "pid": { "type": "integer" },
          "name": { "type": "string" }
        }
      },
      "returns": {
        "type": "object",
        "required": ["pid", "state", "transcript"],
        "properties": {
          "pid": { "type": "integer" },
          "state": { "type": "integer" },
          "transcript": { "type": "string" }
        }
      }
    },
    {
      "name": "lldb.setBreakpoint",
      "description": "设置断点（文件/行、符号或地址三选一）",
      "arguments": {
        "type": "object",
        "required": ["sessionId"],
        "properties": {
          "sessionId": { "type": "string" },
          "file": { "type": "string" },
          "line": { "type": "integer" },
          "symbol": { "type": "string" },
          "address": { "type": "integer" }
        },
        "oneOf": [
          { "required": ["file", "line"] },
          { "required": ["symbol"] },
          { "required": ["address"] }
        ]
      },
      "returns": {
        "type": "object",
        "required": ["breakpointId", "transcript"],
        "properties": {
          "breakpointId": { "type": "integer" },
          "transcript": { "type": "string" }
        }
      }
    },
    {
      "name": "lldb.deleteBreakpoint",
      "description": "删除断点",
      "arguments": { "type": "object", "required": ["sessionId", "breakpointId"], "properties": { "sessionId": { "type": "string" }, "breakpointId": { "type": "integer" } } },
      "returns": { "type": "object", "properties": { "ok": { "type": "boolean" } } }
    },
    {
      "name": "lldb.listBreakpoints",
      "description": "列出断点",
      "arguments": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" } } },
      "returns": {
        "type": "object",
        "properties": {
          "breakpoints": {
            "type": "array",
            "items": { "type": "object", "properties": { "id": { "type": "integer" }, "enabled": { "type": "boolean" }, "hitCount": { "type": "integer" } } }
          }
        }
      }
    },
    {
      "name": "lldb.updateBreakpoint",
      "description": "更新断点属性",
      "arguments": {
        "type": "object",
        "required": ["sessionId", "breakpointId"],
        "properties": {
          "sessionId": { "type": "string" },
          "breakpointId": { "type": "integer" },
          "enabled": { "type": "boolean" },
          "ignoreCount": { "type": "integer" },
          "condition": { "type": "string" }
        }
      },
      "returns": { "type": "object", "properties": { "ok": { "type": "boolean" } } }
    },
    {
      "name": "lldb.continue",
      "description": "继续进程执行",
      "arguments": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" } } },
      "returns": { "type": "object", "properties": { "ok": { "type": "boolean" }, "transcript": { "type": "string" } } }
    },
    {
      "name": "lldb.pause",
      "description": "暂停进程",
      "arguments": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" } } },
      "returns": { "type": "object", "properties": { "ok": { "type": "boolean" } } }
    },
    {
      "name": "lldb.stepIn",
      "description": "单步进入",
      "arguments": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" } } },
      "returns": { "type": "object", "properties": { "ok": { "type": "boolean" }, "transcript": { "type": "string" } } }
    },
    {
      "name": "lldb.stepOver",
      "description": "单步越过",
      "arguments": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" } } },
      "returns": { "type": "object", "properties": { "ok": { "type": "boolean" }, "transcript": { "type": "string" } } }
    },
    {
      "name": "lldb.stepOut",
      "description": "单步返回",
      "arguments": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" } } },
      "returns": { "type": "object", "properties": { "ok": { "type": "boolean" }, "transcript": { "type": "string" } } }
    },
    {
      "name": "lldb.threads",
      "description": "列出线程",
      "arguments": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" } } },
      "returns": { "type": "object", "properties": { "threads": { "type": "array", "items": { "type": "object", "properties": { "id": { "type": "integer" }, "state": { "type": "integer" } } } } } }
    },
    {
      "name": "lldb.frames",
      "description": "列出线程帧",
      "arguments": { "type": "object", "required": ["sessionId", "threadId"], "properties": { "sessionId": { "type": "string" }, "threadId": { "type": "integer" } } },
      "returns": { "type": "object", "properties": { "frames": { "type": "array", "items": { "type": "object", "properties": { "index": { "type": "integer" }, "function": { "type": "string" }, "file": { "type": "string" }, "line": { "type": "integer" }, "pc": { "type": "integer" } } } } } }
    },
    {
      "name": "lldb.stackTrace",
      "description": "获取栈回溯",
      "arguments": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" }, "threadId": { "type": "integer" } } },
      "returns": { "type": "object", "properties": { "frames": { "type": "array", "items": { "type": "object", "properties": { "index": { "type": "integer" }, "function": { "type": "string" }, "file": { "type": "string" }, "line": { "type": "integer" }, "pc": { "type": "integer" } } } } } }
    },
    {
      "name": "lldb.selectThread",
      "description": "选择线程",
      "arguments": { "type": "object", "required": ["sessionId", "threadId"], "properties": { "sessionId": { "type": "string" }, "threadId": { "type": "integer" } } },
      "returns": { "type": "object", "properties": { "ok": { "type": "boolean" } } }
    },
    {
      "name": "lldb.selectFrame",
      "description": "选择帧",
      "arguments": { "type": "object", "required": ["sessionId", "threadId", "frameIndex"], "properties": { "sessionId": { "type": "string" }, "threadId": { "type": "integer" }, "frameIndex": { "type": "integer" } } },
      "returns": { "type": "object", "properties": { "ok": { "type": "boolean" } } }
    },
    {
      "name": "lldb.evaluate",
      "description": "表达式求值",
      "arguments": { "type": "object", "required": ["sessionId", "expr"], "properties": { "sessionId": { "type": "string" }, "expr": { "type": "string" }, "frameIndex": { "type": "integer" } } },
      "returns": { "type": "object", "properties": { "value": { "type": "string" }, "transcript": { "type": "string" } } }
    },
    {
      "name": "lldb.readMemory",
      "description": "读取内存（返回十六进制字节）",
      "arguments": { "type": "object", "required": ["sessionId", "addr", "size"], "properties": { "sessionId": { "type": "string" }, "addr": { "type": "integer" }, "size": { "type": "integer" } } },
      "returns": { "type": "object", "required": ["bytes"], "properties": { "bytes": { "type": "string" } } }
    },
    {
      "name": "lldb.writeMemory",
      "description": "写入内存（输入十六进制字节串）",
      "arguments": { "type": "object", "required": ["sessionId", "addr", "bytes"], "properties": { "sessionId": { "type": "string" }, "addr": { "type": "integer" }, "bytes": { "type": "string" } } },
      "returns": { "type": "object", "required": ["written"], "properties": { "written": { "type": "integer" } } }
    },
    {
      "name": "lldb.pollEvents",
      "description": "轮询事件（断点、监视点、stdout/stderr、transcript等）",
      "arguments": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" }, "limit": { "type": "integer" } } },
      "returns": {
        "type": "object",
        "properties": {
          "events": {
            "type": "array",
            "items": { "type": "object", "properties": { "type": { "type": "string" }, "sessionId": { "type": "string" }, "data": { "type": "object" } } }
          }
        }
      }
    },
    {
      "name": "lldb.setWatchpoint",
      "description": "设置监视点",
      "arguments": { "type": "object", "required": ["sessionId", "addr", "size"], "properties": { "sessionId": { "type": "string" }, "addr": { "type": "integer" }, "size": { "type": "integer" }, "read": { "type": "boolean" }, "write": { "type": "boolean" } } },
      "returns": { "type": "object", "required": ["watchpointId"], "properties": { "watchpointId": { "type": "integer" } } }
    },
    {
      "name": "lldb.deleteWatchpoint",
      "description": "删除监视点",
      "arguments": { "type": "object", "required": ["sessionId", "watchpointId"], "properties": { "sessionId": { "type": "string" }, "watchpointId": { "type": "integer" } } },
      "returns": { "type": "object", "properties": { "ok": { "type": "boolean" } } }
    },
    {
      "name": "lldb.listWatchpoints",
      "description": "列出监视点",
      "arguments": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" } } },
      "returns": {
        "type": "object",
        "properties": {
          "watchpoints": {
            "type": "array",
            "items": { "type": "object", "properties": { "id": { "type": "integer" }, "enabled": { "type": "boolean" }, "hitCount": { "type": "integer" } } }
          }
        }
      }
    },
    {
      "name": "lldb.disassemble",
      "description": "反汇编",
      "arguments": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" }, "addr": { "type": "integer" }, "count": { "type": "integer" } } },
      "returns": {
        "type": "object",
        "properties": {
          "instructions": {
            "type": "array",
            "items": { "type": "object", "properties": { "addr": { "type": "integer" }, "mnemonic": { "type": "string" }, "operands": { "type": "string" } } }
          }
        }
      }
    },
    {
      "name": "lldb.signal",
      "description": "向进程发送信号",
      "arguments": { "type": "object", "required": ["sessionId", "sig"], "properties": { "sessionId": { "type": "string" }, "sig": { "type": "integer" } } },
      "returns": { "type": "object", "properties": { "ok": { "type": "boolean" } } }
    },
    {
      "name": "lldb.restart",
      "description": "按最近启动参数重新启动",
      "arguments": { "type": "object", "required": ["sessionId"], "properties": { "sessionId": { "type": "string" } } },
      "returns": { "type": "object", "required": ["pid", "state"], "properties": { "pid": { "type": "integer" }, "state": { "type": "integer" } } }
    },
    {
      "name": "lldb.command",
      "description": "执行原生 lldb 命令",
      "arguments": { "type": "object", "required": ["sessionId", "command"], "properties": { "sessionId": { "type": "string" }, "command": { "type": "string" } } },
      "returns": { "type": "object", "properties": { "ok": { "type": "boolean" }, "output": { "type": "string" }, "error": { "type": "string" }, "transcript": { "type": "string" } } }
    }
  ],
  "healthCheck": { "type": "tools.call", "name": "lldb.listSessions", "arguments": {} }
}

